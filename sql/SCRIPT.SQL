CREATE TABLE USUARIO (
    ID      BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME    VARCHAR(100) NOT NULL
);

CREATE TABLE COMBUSTIVEL (
    ID          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DESCRICAO   VARCHAR(100) NOT NULL,
    UNIDADE     VARCHAR(10) NOT NULL,
    VALOR       NUMERIC(12,4) NOT NULL,
    ALIQUOTA    NUMERIC(5,2) NOT NULL
);

CREATE TABLE TANQUE (
    ID              BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DESCRICAO       VARCHAR(100) NOT NULL,
    CAPACIDADE      NUMERIC(12,3) NOT NULL,
    COMBUSTIVELID   BIGINT NOT NULL,

    FOREIGN KEY (COMBUSTIVELID) REFERENCES COMBUSTIVEL(ID)
);

CREATE TABLE BOMBA (
    ID          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DESCRICAO   VARCHAR(100) NOT NULL,
    TANQUEID    BIGINT NOT NULL,

    FOREIGN KEY (TANQUEID) REFERENCES TANQUE(ID)
);

CREATE TABLE ABASTECIMENTO (
    ID              BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DATAHORA        TIMESTAMP NOT NULL,
    QUANTIDADE      NUMERIC(12,3) NOT NULL,
    VALORUN         NUMERIC(12,4) NOT NULL,
    ALIQ            NUMERIC(5,2) NOT NULL,
    VALORTOT        NUMERIC(12,4) NOT NULL,

    COMBUSTIVELID   BIGINT NOT NULL,
    USUARIOID       BIGINT NOT NULL,
    BOMBAID         BIGINT NOT NULL,
    TANQUEID        BIGINT NOT NULL,

    FOREIGN KEY (COMBUSTIVELID) REFERENCES COMBUSTIVEL(ID),
    FOREIGN KEY (USUARIOID) REFERENCES USUARIO(ID),
    FOREIGN KEY (BOMBAID) REFERENCES BOMBA(ID),
    FOREIGN KEY (TANQUEID) REFERENCES TANQUE(ID)
);


CREATE TABLE REPOSICAO (
    ID              BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DATAHORA        TIMESTAMP NOT NULL,
    COMBUSTIVELID   BIGINT NOT NULL,
    TANQUEID        BIGINT NOT NULL,
    QUANTIDADE      NUMERIC(12,3) NOT NULL,
    USUARIOID       BIGINT NOT NULL,
    OBSERVACAO      VARCHAR(200),

    FOREIGN KEY (COMBUSTIVELID) REFERENCES COMBUSTIVEL(ID),
    FOREIGN KEY (TANQUEID) REFERENCES TANQUE(ID),
    FOREIGN KEY (USUARIOID) REFERENCES USUARIO(ID)
);

CREATE TABLE TANQUE_MOVIMENTO (
    ID              BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DATAHORA        TIMESTAMP NOT NULL,
    TANQUEID        BIGINT NOT NULL,
    COMBUSTIVELID   BIGINT NOT NULL,
    USUARIOID       BIGINT NOT NULL,
    TIPOMOVIMENTO   SMALLINT NOT NULL, /* 0=entrada, 1=saída */
    QUANTIDADE      NUMERIC(12,3) NOT NULL,
    ORIGEMTIPO      CHAR(2) NOT NULL,   /* 'AB' ou 'RE' */
    ORIGEMID        BIGINT NOT NULL,
    OBSERVACAO      VARCHAR(200),

    FOREIGN KEY (TANQUEID) REFERENCES TANQUE(ID),
    FOREIGN KEY (COMBUSTIVELID) REFERENCES COMBUSTIVEL(ID),
    FOREIGN KEY (USUARIOID) REFERENCES USUARIO(ID),

    CHECK (TIPOMOVIMENTO IN (0,1)),
    CHECK (ORIGEMTIPO IN ('AB','RE'))
);

-- Dados iniciais
INSERT INTO USUARIO (NOME) VALUES
    ('Administrador');

INSERT INTO COMBUSTIVEL (DESCRICAO, UNIDADE, VALOR, ALIQUOTA)
    VALUES ('Gasolina', 'L', 6.5900, 13.00);
INSERT INTO COMBUSTIVEL (DESCRICAO, UNIDADE, VALOR, ALIQUOTA)
    VALUES ('Óleo Diesel', 'L', 4.1900, 13.00);

INSERT INTO TANQUE (DESCRICAO, CAPACIDADE, COMBUSTIVELID)
    VALUES ('Tanque A', 5000.000, 1);
INSERT INTO TANQUE (DESCRICAO, CAPACIDADE, COMBUSTIVELID)
    VALUES ('Tanque B', 4500.000, 2);

INSERT INTO BOMBA (DESCRICAO, TANQUEID)
    VALUES ('Bomba 1', 1);
INSERT INTO BOMBA (DESCRICAO, TANQUEID)
    VALUES ('Bomba 2', 1);
INSERT INTO BOMBA (DESCRICAO, TANQUEID)
    VALUES ('Bomba 3', 2);
INSERT INTO BOMBA (DESCRICAO, TANQUEID)
    VALUES ('Bomba 4', 2);

INSERT INTO REPOSICAO (DATAHORA, COMBUSTIVELID, TANQUEID, QUANTIDADE, USUARIOID, OBSERVACAO)
    VALUES (TIMESTAMP '2024-01-02 08:00', 1, 1, 4500.000, 1, 'Carga inicial Tanque A');
INSERT INTO REPOSICAO (DATAHORA, COMBUSTIVELID, TANQUEID, QUANTIDADE, USUARIOID, OBSERVACAO)
    VALUES (TIMESTAMP '2024-01-02 08:30', 2, 2, 4000.000, 1, 'Carga inicial Tanque B');

INSERT INTO TANQUE_MOVIMENTO (DATAHORA, TANQUEID, COMBUSTIVELID, USUARIOID, TIPOMOVIMENTO,
    QUANTIDADE, ORIGEMTIPO, ORIGEMID, OBSERVACAO) VALUES
    (TIMESTAMP '2024-01-02 08:00', 1, 1, 1, 0, 4500.000, 'RE', 1, 'Carga inicial Tanque A');
INSERT INTO TANQUE_MOVIMENTO (DATAHORA, TANQUEID, COMBUSTIVELID, USUARIOID, TIPOMOVIMENTO,
    QUANTIDADE, ORIGEMTIPO, ORIGEMID, OBSERVACAO) VALUES
    (TIMESTAMP '2024-01-02 08:30', 2, 2, 1, 0, 4000.000, 'RE', 2, 'Carga inicial Tanque B');
